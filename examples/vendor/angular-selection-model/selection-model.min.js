angular.module("selectionModel",[]),angular.module("selectionModel").directive("selectionModelIgnore",[function(){"use strict";return{restrict:"A",link:function(a,b,c){var d=function(a){a.selectionModelIgnore=!0,a.originalEvent&&(a.originalEvent.selectionModelIgnore=!0)};b.on("click",function(b){(!c.selectionModelIgnore||a.$eval(c.selectionModelIgnore))&&d(b)})}}}]),angular.module("selectionModel").directive("selectionModel",["selectionStack","uuidGen","selectionModelOptions","$document",function(a,b,c,d){"use strict";return{restrict:"A",link:function(e,f,g){function h(){for(var a,b,c=f,d=!1,e=5;d!==!0&&e>0;)c=c.parent(),a=c[0]?c[0].tagName:"",("TABLE"===a||"UL"===a||"OL"===a||"NAV"===a)&&(d=!0,b=c[0]),e--;if(!b)throw"selection-model-use-keyboard-navigation must be used inside of a table, ul, ol, or nav element";return b}var i=c.get(),j=i.selectedAttribute,k=i.selectedClass,l=i.type,m=i.mode,n=i.cleanupStrategy,o=i.useKeyboardNavigation,p=e.$eval(g.selectionModelType)||l,q=e.$eval(g.selectionModelMode)||m,r=/^multi(ple)?(-additive)?$/.test(q),s=/^multi(ple)?-additive/.test(q),t=e.$eval(g.selectionModelSelectedAttribute)||j,u=e.$eval(g.selectionModelSelectedClass)||k,v=e.$eval(g.selectionModelCleanupStrategy)||n,w=e.$eval(g.selectionModelUseKeyboardNavigation)||o,x=g.selectionModelOnEnterKeypress;if(x&&!w)throw"selection-model-on-enter-keypress must be used with selection-model-use-keyboard-navigation set to true";var y=g.selectionModelOnChange,z=g.ngRepeat;if(!z)throw"selectionModel must be used along side ngRepeat";var A=e.$eval(g.selectionModelSelectedItems),B=function(){if(!r)return null;var a="data-selection-model-stack-id",c=f.attr(a);return c?c:(c=f.parent().attr(a))?(f.attr(a,c),c):(c=b.create(),f.attr(a,c),f.parent().attr(a,c),c)}(),C=z.split(/\sin\s|\strack\sby\s/g),D=e.$eval(C[0]),E=C.length>2,F=function(){if(D[t]?f.addClass(u):f.removeClass(u),"checkbox"===p){var a=[];angular.forEach(f.find("input"),function(b){b=angular.element(b),"checkbox"===b.attr("type")&&a.push(b)}),a.length&&a[0].prop("checked",D[t])}},G=function(){return e.$eval(C[1])},H=function(){return e.$eval(C[1].split(/[|=]/)[0])},I=function(a){var b,c=angular.isArray(A),d=angular.isArray(a)&&2===a.length,e=H(),f=0,g=!1;c&&(A.length=0),angular.forEach(e,function(e){d?(b=a.indexOf(e),b>-1?(f++,g=!1,a.splice(b,1)):g=1!==f):g=e!==a,g?e[t]=!1:c&&e[t]&&A.push(e)})},J=function(a){var b=G(),c=!1,d=!1;a=a||D,angular.forEach(b,function(b){d=d||b===D,c=c||b===a;var e=c+d===1;(e||b===D||b===a)&&(b[t]=!0)})},K=function(b){if(!(b.selectionModelIgnore||b.originalEvent&&b.originalEvent.selectionModelIgnore||b.selectionModelClickHandled||b.originalEvent&&b.originalEvent.selectionModelClickHandled)){b.selectionModelClickHandled=!0,b.originalEvent&&(b.originalEvent.selectionModelClickHandled=!0);var c=b.ctrlKey||b.metaKey||s,d=b.shiftKey,g=b.target||b.srcElement,h="checkbox"===p&&"INPUT"===g.tagName&&"checkbox"===g.type;if("LABEL"===g.tagName){var i=angular.element(g).attr("for");if(i){var j,k=f[0].getElementsByTagName("INPUT");for(j=k.length;j--;)if(k[j].id===i)return}else if(g.getElementsByTagName("INPUT").length)return}if(d&&r&&!h)return c||e.$apply(function(){I([D,a.peek(B)])}),J(a.peek(B)),void e.$apply();if(c||d||h){var l=!D[t];return r||I(D),D[t]=l,D[t]&&a.push(B,D),void e.$apply()}I(D),e.$apply(),D[t]=!0,a.push(B,D),e.$apply()}},L=function(){var a=d[0].activeElement,b=h();return a===b},M=function(b){var c,d=b.keyCode;if(L()){switch(d){case 38:c="arrowUp";break;case 40:c="arrowDown";break;case 13:c="enter";break;default:return}if("enter"===c)return void e.$eval(x);var f,g=b.shiftKey,h=G(),i=h.length,j=a.peek(B)?a.peek(B):h[0],k=h.indexOf(j);k>-1&&("arrowDown"===c&&i>=k+1?f=h[k+1]:"arrowUp"===c&&k-1>=0&&(f=h[k-1]),f&&(!g&&r&&(I(f),e.$apply()),f[t]=!0,a.push(B,f),e.$apply()))}},N=function(){var a="data-selection-model-keypress-bound";f.parent().attr(a)||(f.parent().attr(a,!0),d.on("keydown",M))};w&&N();var O=function(){if(angular.isArray(A)){var a=A.indexOf(D);D[t]?-1===a&&A.push(D):a>-1&&A.splice(a,1)}};if(f.on("click",K),"checkbox"===p){var P=f.find("input");P[0]&&"checkbox"===P[0].type&&f.find("input").on("click",K)}F(),O(),"deselect"===v&&e.$on("$destroy",function(){var a=D[t];D[t]=!1,O(),y&&a&&e.$eval(y)}),e.$watch(C[0]+"."+t,function(a,b){a!==b&&(r||!a||b||(I(D),D[t]=!0),F(),O(),y&&e.$eval(y))}),E&&e.$watch(C[0],function(a){D=a})}}}]),angular.module("selectionModel").provider("selectionModelOptions",[function(){"use strict";var a={selectedAttribute:"selected",selectedClass:"selected",type:"basic",mode:"single",cleanupStrategy:"none",useKeyboardNavigation:!1};this.set=function(b){angular.extend(a,b)},this.$get=function(){var b={get:function(){return angular.copy(a)}};return b}}]),angular.module("selectionModel").service("selectionStack",function(){"use strict";var a={},b=1e3,c={};return a.push=function(a,d){c.hasOwnProperty(a)||(c[a]=[]);var e=c[a];for(e.push(d);e.length>b;)e.shift();return e.length},a.pop=function(a){c.hasOwnProperty(a)||(c[a]=[]);var b=c[a];return b.pop()},a.peek=function(a){c.hasOwnProperty(a)||(c[a]=[]);var b=c[a];return b.length?b[b.length-1]:void 0},a}),angular.module("selectionModel").service("uuidGen",function(){"use strict";var a={},b=["0","0","0"];return a.create=function(){for(var a,c=b.length;c;){if(c--,a=b[c].charCodeAt(0),57===a)return b[c]="A",b.join("");if(90!==a)return b[c]=String.fromCharCode(a+1),b.join("");b[c]="0"}return b.unshift("0"),b.join("")},a});